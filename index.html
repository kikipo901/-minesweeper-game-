<link rel="stylesheet" href="style.css">
<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Google Fonts: Poppins å­—é«” -->
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
  <!-- Google Fonts: Patrick Hand å­—é«” -->
<link href="https://fonts.googleapis.com/css2?family=Patrick+Hand&display=swap" rel="stylesheet">

<meta charset="UTF-8">
  <title>è‡ªè¨‚è¸©åœ°é›·éŠæˆ²</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  
  <h1>è¸©åœ°é›·éŠæˆ²</h1>

  <!-- ç©å®¶è¼¸å…¥æ ¼å­æ•¸èˆ‡åœ°é›·æ•¸ -->
  <label>è¡Œæ•¸: <input type="number" id="rowsInput" value="8" min="2"></label>
  <label>åˆ—æ•¸: <input type="number" id="colsInput" value="8" min="2"></label>
  <label>åœ°é›·æ•¸: <input type="number" id="mineInput" value="10" min="1"></label>
  <button onclick="startGame()">é–‹å§‹éŠæˆ²</button>
  <button id="resetButton" style="display: none;" onclick="startGame()">é‡æ–°é–‹å§‹éŠæˆ²</button>

  <div id="board"></div>

  <script>
    let board, rows, cols, mineCount, mines;

    // å•Ÿå‹•éŠæˆ²
    function startGame() {
      rows = parseInt(document.getElementById("rowsInput").value);
      cols = parseInt(document.getElementById("colsInput").value);
      mineCount = parseInt(document.getElementById("mineInput").value);

      if (mineCount >= rows * cols) {
        alert("åœ°é›·æ•¸ä¸èƒ½è¶…éæ ¼å­ç¸½æ•¸ï¼");
        return;
      }

      // æ¸…ç©ºèˆŠéŠæˆ²
      const boardContainer = document.getElementById("board");
      boardContainer.innerHTML = "";

      // è¨­å®šç¶²æ ¼æ¨£å¼
boardContainer.style.display = "grid";
boardContainer.style.gridTemplateColumns = `repeat(${cols}, 80px)`; // çµ±ä¸€ç‚º 80px
boardContainer.style.gridGap = "5px"; // å’Œ CSS ä¸­çš„ gap ä¸€è‡´

      // åˆå§‹åŒ–è®Šæ•¸
      mines = Array(rows * cols).fill(0);

      // éš¨æ©Ÿæ”¾ç½®åœ°é›·
      let count = 0;
      while (count < mineCount) {
        let randomIndex = Math.floor(Math.random() * (rows * cols));
        if (mines[randomIndex] !== "M") {
          mines[randomIndex] = "M";
          count++;
        }
      }

      // å»ºç«‹ç¶²æ ¼
      for (let i = 0; i < rows * cols; i++) {
        const cell = document.createElement("div");
        cell.classList.add("cell");
        cell.dataset.index = i;

        cell.addEventListener("click", revealCell);
        cell.addEventListener("contextmenu", markFlag);

        boardContainer.appendChild(cell);
      }
    }

    // é¡¯ç¤ºæ ¼å­å…§å®¹ (æ›´æ–°åœ°é›·åˆ¤æ–·)
    function revealCell(e) {
      const index = parseInt(e.target.dataset.index);
      const cell = e.target;

      // å¦‚æœå·²ç¶“æ‰“é–‹ï¼Œå‰‡ä¸é‡è¤‡æ“ä½œ
      if (cell.classList.contains("open")) return;

      // å¦‚æœæ˜¯åœ°é›·ï¼ŒçµæŸéŠæˆ²
      if (mines[index] === "M") {
        cell.classList.add("mine");
        cell.innerText = "ğŸ’£";
        showResetMessage("ğŸ’¥ Game Over! ä½ è¸©åˆ°åœ°é›·äº†ï¼");
        return;
      }

      // è¨ˆç®—ä¸¦é¡¯ç¤ºå‘¨åœåœ°é›·æ•¸
      let count = getMineCount(index);
      cell.classList.add("open");
      if (count > 0) cell.innerText = count;

      // æ¯æ¬¡æ‰“é–‹æ ¼å­å¾Œï¼Œæª¢æŸ¥æ˜¯å¦é”æˆå‹åˆ©æ¢ä»¶
      checkWin();
    }

    // å³éµæ’æ——åŠŸèƒ½
    function markFlag(e) {
      e.preventDefault();
      const cell = e.target;
      if (!cell.classList.contains("open")) {
        cell.innerText = cell.innerText === "ğŸš©" ? "" : "ğŸš©";
      }
    }

    // è¨ˆç®—å‘¨åœåœ°é›·æ•¸
    function getMineCount(index) {
      let count = 0;
      const directions = [-1, 1, -cols, cols, -cols - 1, -cols + 1, cols - 1, cols + 1];
      directions.forEach(offset => {
        const neighbor = index + offset;
        const isLeftEdge = (index % cols === 0);
        const isRightEdge = (index % cols === cols - 1);

        if (isLeftEdge && (offset === -1 || offset === -cols - 1 || offset === cols - 1)) return;
        if (isRightEdge && (offset === 1 || offset === -cols + 1 || offset === cols + 1)) return;

        if (neighbor >= 0 && neighbor < rows * cols && mines[neighbor] === "M") {
          count++;
        }
      });
      return count;
    }

    // é¡¯ç¤ºé‡ç½®æç¤º
    function showResetMessage(message) {
      alert(message);
      document.getElementById("resetButton").style.display = "block"; // é¡¯ç¤ºé‡ç½®æŒ‰éˆ•
    }

    // æª¢æŸ¥æ˜¯å¦å‹åˆ©
    function checkWin() {
      const cells = document.querySelectorAll(".cell");
      let openedCount = 0;

      // è¨ˆç®—å·²æ‰“é–‹çš„æ ¼å­æ•¸é‡
      cells.forEach(cell => {
        if (cell.classList.contains("open")) openedCount++;
      });

      // å¦‚æœæ‰“é–‹çš„æ ¼å­æ•¸é‡ç­‰æ–¼ "ç¸½æ ¼å­æ•¸ - åœ°é›·æ•¸"ï¼Œè¡¨ç¤ºç©å®¶å‹åˆ©
      if (openedCount === rows * cols - mineCount) {
        showResetMessage("ğŸ‰ æ­å–œä½ ï¼ŒæˆåŠŸéé—œï¼");
      }
    }

    // é è¨­å•Ÿå‹•éŠæˆ²
    startGame();
  </script>
</body>
</html>
